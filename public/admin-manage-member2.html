ADMIN MANAGE MEMBER2 HTML

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin - Manage Members</title>
  <link rel="stylesheet" href="./admin-mainpage.css" />
  <style>
    /* overrides for members area */
    .members-panel { background:#1e1e1e; padding:16px; border-radius:8px; margin:16px 0; box-shadow:0 1px 6px rgba(0,0,0,0.05); }
    table { width:100%; border-collapse:collapse; margin-top:12px; color: white; }
    th, td { text-align:left; padding:8px; border-bottom:1px solid #333; }
    .btn { padding:6px 10px; border-radius:6px; border:none; cursor:pointer; }
    .btn.add { background:#198754; color:#fff; }
    .btn.edit { background:#ffc107; color:#222; }
    .btn.delete { background:#dc3545; color:#fff; }
    .pill { display:inline-block; padding:4px 8px; background:#333; border-radius:999px; font-size:12px; color:#fff; }
    .modal-backdrop { position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,0.6); z-index:60; }
    .modal { background:#111; color:white; padding:16px; border-radius:8px; width:520px; max-width:94%; border:1px solid #333; }
    .form-row { display:flex; gap:8px; margin-bottom:8px; }
    .form-row input, .form-row select { flex:1; padding:8px; border-radius:6px; border:1px solid #333; background:#0f0f0f; color:white; }
    .small { font-size:13px; color:#ccc; }
    .search-container { display:flex; gap:8px; align-items:center; }
  </style>
</head>
<body>
  <header class="admin-header">
    <h1>GOALS Gym Admin Dashboard</h1>
    <div style="display:flex; align-items:center; gap:12px;">
      <a href="admin-mainpage.html" style="color:#ff3333; text-decoration:none; margin-right:8px;">Back</a>
      <span id="adminName" class="small">Admin</span>
      <button class="logout-btn" id="logoutBtn">Logout</button>
    </div>
  </header>

  <main class="admin-content">
    <h2>Manage Members</h2>
    <section class="members-panel" id="membersSection">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div class="search-container">
          <!-- CHANGED: replaced Create Member button with Search field -->
          <input id="search" placeholder="Search name / email / ID / phone" style="padding:8px; border-radius:6px; border:1px solid #333; background:#0f0f0f; color:white; width:360px;" />
          <!-- small Add button to open modal -->
          <button id="openCreate" class="btn add">Add</button>
        </div>
        <div class="small">Showing <span id="count">0</span> members</div>
      </div>

      <table id="membersTable" aria-live="polite">
        <thead>
          <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Join Date</th>
            <th>Email</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>
  </main>

  <!-- modal (same as dashboard modal) -->
  <div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-modal="true">
    <div class="modal">
      <h3 id="modalTitle">Create Member</h3>
      <div>
        <div class="form-row">
          <input id="name" placeholder="Full name" />
          <select id="type">
            <option value="combative">combative</option>
            <option value="monthly">monthly</option>
          </select>
        </div>
        <div class="form-row">
          <input id="joinDate" type="date" />
          <input id="email" type="email" placeholder="email@example.com" />
        </div>
        <div class="form-row">
          <input id="phone" placeholder="Phone (optional)" />
          <select id="status">
            <option value="active">active</option>
            <option value="inactive">inactive</option>
            <option value="pending">pending</option>
            <option value="suspended">suspended</option>
          </select>
        </div>

        <div style="display:flex; justify-content:flex-end; gap:8px; margin-top:8px;">
          <button id="cancel" class="btn">Cancel</button>
          <button id="save" class="btn add">Save</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // API base detection (same as dashboard)
    let API_BASE = '/api/members';
    const origin = window.location.origin || '';
    if (origin.includes(':5500') || origin.includes('127.0.0.1:5500')) {
      API_BASE = 'http://localhost:8080/api/members';
    }

    // Elements
    const openCreate = document.getElementById('openCreate');
    const modal = document.getElementById('modalBackdrop');
    const modalTitle = document.getElementById('modalTitle');
    const nameEl = document.getElementById('name');
    const typeEl = document.getElementById('type');
    const joinDateEl = document.getElementById('joinDate');
    const emailEl = document.getElementById('email');
    const phoneEl = document.getElementById('phone');
    const statusEl = document.getElementById('status');
    const cancelBtn = document.getElementById('cancel');
    const saveBtn = document.getElementById('save');
    const tbody = document.querySelector('#membersTable tbody');
    const countEl = document.getElementById('count');
    const searchEl = document.getElementById('search');

    let members = [];
    let editingId = null;

    function escapeHtml(s) {
      if (!s) return '';
      return String(s).replace(/[&<>"']/g, m => ({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' })[m]);
    }
    function formatDate(d) {
      if (!d) return '-';
      const dt = new Date(d);
      if (isNaN(dt)) return d;
      return dt.toLocaleDateString(undefined, { year:'numeric', month:'short', day:'numeric' });
    }

    // API helpers with basic error handling
    async function apiGet() {
      try { const r = await fetch(API_BASE); if (!r.ok) throw new Error('api'); return await r.json(); } catch(e) { return null; }
    }
    async function apiPost(body) {
      try { const r = await fetch(API_BASE, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body) }); if(!r.ok) { const err = await r.json().catch(()=>null); throw new Error(err && err.error ? JSON.stringify(err) : 'api'); } return await r.json(); } catch(e) { return null; }
    }
    async function apiPut(id, body) {
      try { const r = await fetch(API_BASE + '/' + id, { method:'PUT', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body) }); if(!r.ok) { const err = await r.json().catch(()=>null); throw new Error(err && err.error ? JSON.stringify(err) : 'api'); } return await r.json(); } catch(e) { return null; }
    }
    async function apiDelete(id) {
      try { const r = await fetch(API_BASE + '/' + id, { method:'DELETE' }); if(!r.ok) { const err = await r.json().catch(()=>null); throw new Error(err && err.error ? JSON.stringify(err) : 'api'); } return await r.json(); } catch(e) { return null; }
    }

    // localStorage fallback (keeps demo behaviour if API unreachable)
    const LS_KEY = 'goals_members_demo_v1';
    function lsLoad() {
      const raw = localStorage.getItem(LS_KEY);
      if (!raw) {
        const sample = [
          { id: 'm1', name: 'Herod Velasco', type: 'combative', joinDate: '2025-08-11', email: '2201651@slu.edu.ph', status: 'inactive', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString() },
          { id: 'm2', name: 'Ronald', type: 'combative', joinDate: '2025-08-15', email: 'test@gmail.com', status: 'active', createdAt: new Date().toISOString(), updatedAt: new Date().toISOString() }
        ];
        localStorage.setItem(LS_KEY, JSON.stringify(sample));
        return sample;
      }
      return JSON.parse(raw);
    }
    function lsSave(arr){ localStorage.setItem(LS_KEY, JSON.stringify(arr)); }

    // load members (API first else LS)
    async function loadMembers() {
      const remote = await apiGet();
      if (remote && Array.isArray(remote)) {
        members = remote.map(m => ({ id: m._id || m.id, ...m }));
      } else {
        members = lsLoad();
      }
      render();
    }

    function render() {
      const q = (searchEl.value || '').toLowerCase().trim();
      const filtered = q ? members.filter(m => (m.name||'').toLowerCase().includes(q) || (m.email||'').toLowerCase().includes(q) || (m.type||'').toLowerCase().includes(q) || (m.phone||'').toLowerCase().includes(q) || (m.id||'').toLowerCase().includes(q)) : members;
      tbody.innerHTML = '';
      if (filtered.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6">No records</td></tr>';
      } else {
        filtered.forEach(m => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${escapeHtml(m.name)}</td>
            <td><span class="pill">${escapeHtml(m.type)}</span></td>
            <td>${formatDate(m.joinDate || m.createdAt)}</td>
            <td>${escapeHtml(m.email)}</td>
            <td>${escapeHtml(m.status)}</td>
            <td>
              <button class="btn edit" data-id="${m.id}">Edit</button>
              <button class="btn delete" data-id="${m.id}">Delete</button>
            </td>
          `;
          tbody.appendChild(tr);
        });
      }
      countEl.textContent = members.length;
    }

    // modal handlers (used for both create & edit)
    function openCreateModal() {
      editingId = null; modalTitle.textContent = 'Add Member';
      nameEl.value = ''; typeEl.value = 'combative'; joinDateEl.value = new Date().toISOString().slice(0,10);
      emailEl.value = ''; phoneEl.value = ''; statusEl.value = 'active';
      modal.style.display = 'flex';
    }
    function openEditModal(id) {
      const m = members.find(x => x.id === id);
      if (!m) return alert('Member not found');
      editingId = id; modalTitle.textContent = 'Edit Member';
      nameEl.value = m.name || ''; typeEl.value = m.type || 'combative';
      joinDateEl.value = m.joinDate ? new Date(m.joinDate).toISOString().slice(0,10) : '';
      emailEl.value = m.email || ''; phoneEl.value = m.phone || ''; statusEl.value = m.status || 'active';
      modal.style.display = 'flex';
    }
    cancelBtn.addEventListener('click', () => modal.style.display = 'none');
    modal.addEventListener('click', (e) => { if (e.target === modal) modal.style.display = 'none'; });

    // Save (create or update)
    saveBtn.addEventListener('click', async () => {
      const payload = {
        name: nameEl.value.trim(), type: typeEl.value, joinDate: joinDateEl.value || null,
        email: emailEl.value.trim(), phone: phoneEl.value.trim(), status: statusEl.value
      };
      if (!payload.name) return alert('Please provide a name');

      if (editingId) {
        const updated = await apiPut(editingId, payload);
        if (updated && (updated._id || updated.id)) {
          const idx = members.findIndex(m => m.id === (updated._id || updated.id) || m.id === editingId);
          if (idx !== -1) members[idx] = { id: updated._id || updated.id, ...updated };
        } else {
          // fallback: update local only
          const idx = members.findIndex(m => m.id === editingId);
          if (idx !== -1) { members[idx] = { ...members[idx], ...payload, updatedAt: new Date().toISOString() }; lsSave(members); }
        }
      } else {
        const created = await apiPost(payload);
        if (created && (created._id || created.id)) {
          members.unshift({ id: created._id || created.id, ...created });
        } else {
          // fallback to LS
          const newId = 'm_' + Date.now();
          const newMember = { id: newId, ...payload, createdAt: new Date().toISOString(), updatedAt: new Date().toISOString() };
          members.unshift(newMember);
          lsSave(members);
        }
      }

      modal.style.display = 'none';
      render();
    });

    // delegate edit/delete
    tbody.addEventListener('click', async (e) => {
      const btn = e.target.closest('button');
      if (!btn) return;
      const id = btn.dataset.id;
      if (btn.classList.contains('edit')) {
        openEditModal(id);
      } else if (btn.classList.contains('delete')) {
        if (!confirm('Delete this member?')) return;
        const res = await apiDelete(id);
        if (res && res.success) {
          members = members.filter(m => m.id !== id);
        } else {
          // fallback
          members = members.filter(m => m.id !== id);
          lsSave(members);
        }
        render();
      }
    });

    // wire buttons and search
    openCreate.addEventListener('click', openCreateModal);
    searchEl.addEventListener('input', render);

    // initial load
    loadMembers();
  </script>
</body>
</html>
